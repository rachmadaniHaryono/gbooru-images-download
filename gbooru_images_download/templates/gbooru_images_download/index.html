{% extends 'admin/base.html' %}

{% block head %}
{{super()}}
<link rel="shortcut icon" href="#" />
{% endblock %}

{% block head_css %}
{{super()}}
<style>
*, *:before, *:after {box-sizing:  border-box !important;}
.row {
 -moz-column-width: 20em;
 -webkit-column-width: 20em;
 -moz-column-gap: 4px;
 -webkit-column-gap:4px;
}
.row > .col-md-3 {
 display: inline-block;
 padding: 0;
 margin: 0;
 width:  100%;
 float:none;
}
.img-responsive {
  border:0px solid #999;
}
</style>
{% endblock %}

{% block body %}
{{super()}}
<form method="GET" action="/">
  <div class="form-group"> {{ form.query.label }} {{ form.query(size=100, class_="form-control") }} </div>
  <div class="checkbox"> <label>{{form.disable_cache(type='checkbox')}}{{form.disable_cache.label}}</label></div>
  <button type="submit" class="btn btn-default">Submit</button>
</form>
{% if entry.search_results|length > 1 %}
{{pagination_section(info=False)}}
{% endif %}
<br>
{% if entry %}<p> {{entry.match_results|length}} Results<br/> {% endif %}
{% if entry.match_results|length != match_results|length %}{{match_results|length}} Shown</p>{% endif %}
{{pagination_section(info=False)}}
<div class="row">
  {% for match_result in match_results %}
  <figure class="col-md-3" id="mr{{match_result.id}}">
    <a class="thumb" href="{{url_for('u.index', u=match_result.img_url.url)}}">
      <img style="" class="img-responsive" src="{{match_result.thumbnail_url.url}}">
    </a>
    <figcaption>
      <a class="btn btn-default btn-md" href="{{match_result.img_url.url}}">{{match_result.img_url.width}}x{{match_result.img_url.height}}</a>
      <a class="btn btn-default btn-md" href="{{url_for('f.index', url=match_result.img_url.url, search_type=1)}}">
        <span class="fa fa-search glyphicon glyphicon-search"></span> similar
      </a>
      <br/>
      <a class="btn btn-default btn-md" href="{{url_for('f.index', url=match_result.img_url.url, search_type=2)}}">
        <span class="fa fa-search glyphicon glyphicon-search"></span> size
      </a>
      <button class="btn btn-default hide-btn btn-md" type="button" data-id="{{match_result.img_url.id}}"
        data-mr-id="mr{{match_result.id}}">
        <span class="fa fa-filter glyphicon glyphicon-filter"></span> filter
      </button>
    </figcaption>
  </figure>
{% endfor %}
</div>
<br>
{{pagination_section(info=False)}}
{% endblock body %}

{% block tail_js %}
{{super()}}
<script src="{{url_for('static', filename="gbooru_images_download/index.js")}}" type="text/javascript"> </script>
{% endblock %}

{% macro pagination_section(info=True)%}
  {% if info %} {{ pagination.info }} {% endif %}
  {{ pagination.links }}
  {% if query and not pagination.has_next and entry %}
  <ul class="pagination">
    <li class="next"><a href="{{url_for('admin.index', query=query, page=pagination.page+1)}}">load next page</a></li>
  </ul>
  {% endif %}
{% endmacro %}
